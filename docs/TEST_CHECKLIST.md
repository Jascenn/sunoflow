# 📋 模拟支付功能测试清单

## 开始测试前

- [ ] 确认开发服务器正在运行 (`pnpm dev`)
- [ ] 确认数据库连接正常
- [ ] 浏览器已登录用户账号

---

## 测试步骤

### 1. 访问充值页面 ✅
- [ ] 打开 http://localhost:3000/recharge
- [ ] 页面正常加载,无错误
- [ ] 看到"充值积分"标题

### 2. 检查UI组件 ✅
- [ ] 看到黄色的"开发测试模式"横幅
- [ ] 看到当前余额卡片
- [ ] 看到 4 个套餐卡片(入门、基础、专业、企业)
- [ ] "基础套餐"有"最受欢迎"标签

### 3. 测试模式开关 ✅
- [ ] 开关默认是开启状态(黄色)
- [ ] 显示文字:"使用模拟支付(无需真实付款)"
- [ ] 点击开关可以切换状态
- [ ] 关闭时显示:"使用真实支付(需要 Stripe 配置)"

### 4. 选择套餐 ✅
- [ ] 点击"基础套餐"卡片
- [ ] 卡片有蓝色边框和阴影(选中状态)
- [ ] 右上角显示蓝色对勾 ✓
- [ ] 底部出现"确认充值"区域

### 5. 确认充值信息 ✅
- [ ] 显示"已选套餐: 基础套餐"
- [ ] 显示"330 积分"(300 + 30 赠送)
- [ ] 显示"支付金额: ¥49 ($6.99)"
- [ ] 按钮文字:"立即支付 ¥49"

### 6. 执行模拟支付 ✅
- [ ] 确认模拟支付开关是开启状态
- [ ] 点击"立即支付"按钮
- [ ] 看到 toast 提示:"使用模拟支付进行测试"
- [ ] 页面跳转到成功页面

### 7. 验证成功页面 ✅
- [ ] URL 是 `/payment/mock-success?session_id=...`
- [ ] 看到绿色对勾图标 ✓
- [ ] 标题:"模拟支付成功!"
- [ ] 显示黄色横幅:"🧪 这是测试模式"
- [ ] 充值套餐:"基础套餐"
- [ ] 获得积分:"+330 积分"
- [ ] 有"返回控制台"和"继续充值"按钮
- [ ] 倒计时:"5秒后自动跳转..."

### 8. 验证积分到账 ✅
- [ ] 等待跳转或点击"返回控制台"
- [ ] 回到 Dashboard 页面
- [ ] 右上角钱包余额已增加 330 积分
- [ ] (可选) 刷新页面,积分仍然存在

### 9. 验证数据库记录 ✅
- [ ] 打开 Prisma Studio (http://localhost:5555)
- [ ] 打开 Wallet 表
- [ ] 找到你的用户记录,balance = 330
- [ ] 打开 Transaction 表
- [ ] 看到新的交易记录:
  - amount: 330
  - type: RECHARGE
  - description: "模拟充值 - 基础套餐"
  - referenceId: "mock_session_..."

### 10. 测试多次充值 ✅
- [ ] 再次访问充值页面
- [ ] 当前余额显示:330 积分
- [ ] 选择"入门套餐"(100 积分)
- [ ] 完成支付
- [ ] 余额变为:430 积分 (330 + 100)

---

## 高级测试

### 测试真实支付模式切换
- [ ] 关闭模拟支付开关
- [ ] 选择套餐并点击支付
- [ ] 看到错误提示(因为没有配置 Stripe)
- [ ] 或跳转到 Stripe Checkout(如果配置了)

### 测试不同套餐
- [ ] 入门套餐:100 积分,¥19
- [ ] 基础套餐:330 积分,¥49
- [ ] 专业套餐:900 积分,¥99
- [ ] 企业套餐:2300 积分,¥199

### 测试错误处理
- [ ] 未选择套餐直接支付
- [ ] 看到错误提示:"请选择充值套餐"
- [ ] 数据库连接失败的情况(如果可能)

---

## 浏览器控制台检查

### 无错误
- [ ] Console 标签没有红色错误
- [ ] 只有正常的日志输出

### 网络请求
- [ ] POST /api/payment/mock-checkout
  - Status: 200
  - Response: { url: "...", mock: true }

### 日志输出
```
[MOCK PAYMENT] Creating mock payment for user xxx
[MOCK PAYMENT] Plan: 基础套餐, Credits: 330
[MOCK PAYMENT] Success! New balance: 330
```

---

## 性能检查

- [ ] 页面加载时间 < 2秒
- [ ] 支付按钮点击响应 < 500ms
- [ ] 页面跳转流畅,无卡顿

---

## 兼容性检查

- [ ] Chrome 浏览器测试通过
- [ ] (可选) Firefox 测试通过
- [ ] (可选) Safari 测试通过
- [ ] 响应式布局(缩小浏览器窗口)

---

## 结果

### ✅ 通过
所有测试项都打勾,功能正常!

### ❌ 失败
记录失败的测试项和错误信息:

```
测试项: _______________
错误信息: _______________
复现步骤: _______________
```

---

## 下一步

- [ ] 阅读完整文档: MOCK_PAYMENT_TEST_GUIDE.md
- [ ] 测试音乐生成功能(使用充值的积分)
- [ ] 配置真实 Stripe 支付
- [ ] 部署到生产环境

---

**测试时间:** _______________
**测试人员:** _______________
**测试结果:** ✅ 通过 / ❌ 失败
